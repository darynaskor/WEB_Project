# Image Manager: Асинхронний Сервіс Обробки Зображень

## Оновлення: локальний API для історії задач

У репозиторій додано Node.js API на базі SQLite (`server/index.cjs`), що зберігає історію обробки зображень та стан активних задач. Для запуску фронтенда тепер треба підняти два процеси:

1. **Сервер задач (балансувальник + два application servers)**
   ```bash
   npm install
   npm run server
   ```
   Ця команда запускає HTTPS load balancer на `https://localhost:4000/api`, який розподіляє запити між двома application серверами на `http://localhost:5001` і `http://localhost:5002`. Кількість портів можна задати змінною `APP_SERVER_PORTS` (наприклад, `APP_SERVER_PORTS=5001,5002,5003`). 

   Макс. кількість паралельних задач на користувача контролюється `MAX_ACTIVE_TASKS` (стандартно 5). Дані спільні для всіх бекендів і зберігаються в `server/tasks.db`.

   Для відлагодження доступний режим без балансувальника:
   ```bash
   npm run server:single
   ```

2. **Фронтенд (Vite)**
   ```bash
   npm run dev
   ```
   Додаток очікує доступний API на `https://localhost:4000/api`. При потребі можна задати `VITE_API_BASE` у `.env` файлі.

Функціонал застосунку тепер відповідає вимогам:
- обмеження на складність задачі (перевірка на клієнті) та ліміт одночасних задач (перевірка на сервері);
- клієнт показує прогрес, дозволяє скасувати задачу, запускати нову і завантажувати результат обробки;
- історія задач та статуси зберігаються у БД і доступні на вкладці «Історія задач».

## HTTPS та авторизація

- Сервер працює **по HTTPS**. Стандарні шляхи до самопідписаного сертифіката: `server/certs/server.crt`, ключ: `server/certs/server.key`. Можна змінити через змінні `CERT_PATH` та `KEY_PATH`.
- Приклад генерації сертифіката:
  ```bash
  mkdir -p server/certs
  openssl req -x509 -newkey rsa:2048 \\
    -keyout server/certs/server.key \\
    -out server/certs/server.crt \\
    -days 365 -nodes -subj "/CN=localhost"
  ```
  Після цього додайте сертифікат до довірених у браузері (для Chrome/Safari — подвійний клік на `.crt`).

- Токени видаються за допомогою JWT. Змінна `JWT_SECRET` дозволяє встановити власний секрет. Термін дії токена — 2 години (`JWT_EXPIRES_IN`).
- API ендпоїнти для авторизації:
  - `POST /api/auth/register` — реєстрація (email + пароль)
  - `POST /api/auth/login` — вхід, повертає `{ user, token }`
  - усі `/api/tasks/*` потребують заголовка `Authorization: Bearer <token>` і повертають дані лише поточного користувача.
- У фронтенді зʼявилась форма входу/реєстрації. Після успішної авторизації токен зберігається у `localStorage`, і можна запускати обробку.


## Опис проєкту
**Image Manager** — веб-застосунок для **завантаження, обробки та редагування зображень** із використанням React.  
Основна функція системи — **завантаження фото з комп’ютера, застосування фільтрів та ефектів, збереження результату**, із відстеженням прогресу завантаження та змін.  
Додатково підтримується функціонал **Reset** (повернення зображення до початкового стану) та **Back** (відкат одного кроку редагування).

---

## Вимоги

### Обмеження
- Максимальний розмір файлу для завантаження: **5 MB**  
- Усі завантажені зображення обрізаються до **єдиного розміру** (наприклад, 600x400px)  
- Під час редагування застосовуються лише обрані фільтри  

---

### Хід виконання задачі
1. **10%** — підготовка (вибір файлу, перевірка розміру)  
2. **50%** — завантаження та обрізка/масштабування  
3. **90%** — застосування фільтрів та обробка зображення  
4. **100%** — готово (завантажене та оброблене зображення відображається на сторінці)  

---

### Історія редагувань
Зберігається інформація про:  
- Поточний стан фільтрів  
- Попередні кроки редагування для функції **Back**  
- Завантажене зображення та його URL  

---

### Функціонал користувача
- Завантаження зображень з комп’ютера  
- Застосування фільтрів (Brightness, Contrast, Saturation, Grayscale, Sepia, Hue, Blur)  
- Використання кнопок **Reset** та **Back**  
- Перегляд прогресу завантаження та обробки  

---

### Прогрес-бар
- Відображає **хід завантаження та обробки зображення**  
- Показує етапи: підготовка → завантаження → обробка → готово  
- З’являється лише під час завантаження/обробки  

---

### Інтерфейс користувача
- **Toolbar**: PROFILE, HISTORY, LOGOUT  
- **Sidebar**: список фільтрів, кнопки Reset, Back та Upload  
- **Main Image**: відображення завантаженого та обробленого зображення  
- **Slider**: регулювання інтенсивності вибраного фільтру  

---

### Безпека
- Всі запити виконуються через **HTTPS**  
- Перевірка розміру файлу перед завантаженням  
- Обмеження на формат файлів (JPG, PNG)  

---

### Можливе розширення
- Збереження оброблених зображень у локальній колекції користувача  
- Завантаження кількох зображень одночасно  
- Підтримка додаткових фільтрів та ефектів  

---
   
